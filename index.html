<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Spotify Player</title>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        h1 {
            margin-bottom: 20px;
        }
        #login {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: #1db954;
            color: white;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .song-list {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
            width: 100%;
            text-align: left;
        }
        .song-list li {
            margin: 5px 0;
            cursor: pointer;
            padding: 10px;
            background: #282828;
            border-radius: 5px;
            display: flex;
            align-items: center;
        }
        .song-list li img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }
        .song-list li:hover {
            background: #1db954;
        }
        audio {
            margin-top: 20px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Advanced Spotify Player</h1>
    <button id="login">Log in with Spotify</button>
    <ul class="song-list" id="songList"></ul>
    <audio id="audio" controls></audio>

    <script>
        const clientId = '439a939c9365478cb27eea6dd019565a'; // Your Client ID
        const redirectUri = 'http://localhost:3000'; // Replace with your chosen Redirect URI
        let accessToken;

        document.getElementById('login').addEventListener('click', () => {
            const scope = 'streaming user-read-email user-read-private';
            window.location = `https://accounts.spotify.com/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=token`;
        });

        const getTokenFromUrl = () => {
            const hash = window.location.hash;
            if (!hash) return null;
            const token = hash.split('&').find(param => param.startsWith('access_token')).split('=')[1];
            return token;
        };

        window.onload = () => {
            accessToken = getTokenFromUrl();
            if (accessToken) {
                initializePlayer();
                fetchSongs();
            }
        };

        const initializePlayer = () => {
            const player = new Spotify.Player({
                name: 'Web Player',
                getOAuthToken: cb => { cb(accessToken); },
                volume: 0.5
            });

            player.connect();

            player.on('player_state_changed', state => {
                console.log(state);
            });
        };

        const fetchSongs = async () => {
            const response = await fetch(`https://api.spotify.com/v1/search?q=track&type=track`, {
                headers: { 'Authorization': `Bearer ${accessToken}` }
            });
            const data = await response.json();
            displaySongs(data.tracks.items);
        };

        const displaySongs = (songs) => {
            const songList = document.getElementById('songList');
            songList.innerHTML = '';
            songs.forEach(song => {
                const li = document.createElement('li');
                li.innerHTML = `<img src="${song.album.images[0]?.url}" alt="${song.name} cover"> 
                                ${song.name} by ${song.artists.map(artist => artist.name).join(', ')}`;
                li.addEventListener('click', () => {
                    playSong(song.uri);
                });
                songList.appendChild(li);
            });
        };

        const playSong = (uri) => {
            const player = new Spotify.Player({
                name: 'Web Player',
                getOAuthToken: cb => { cb(accessToken); },
            });
            player.connect().then(success => {
                if (success) {
                    player.resume().then(() => {
                        player.play({ uris: [uri] });
                    });
                }
            });
        };
    </script>
</body>
</html>
