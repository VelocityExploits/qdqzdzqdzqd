<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Spotify Player</title>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <style>
        /* Your styles here */
    </style>
</head>
<body>
    <h1>Advanced Spotify Player</h1>
    <button id="login">Log in with Spotify</button>
    <div id="player"></div>
    <ul id="songList"></ul>

    <script>
        const clientId = 'YOUR_CLIENT_ID'; // Replace with your Client ID
        const redirectUri = 'YOUR_REDIRECT_URI'; // Replace with your Redirect URI
        let accessToken;

        document.getElementById('login').addEventListener('click', () => {
            const scope = 'streaming user-read-email user-read-private';
            window.location = `https://accounts.spotify.com/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=token`;
        });

        const getTokenFromUrl = () => {
            const hash = window.location.hash;
            if (!hash) return null;
            const token = hash.split('&').find(param => param.startsWith('access_token')).split('=')[1];
            return token;
        };

        window.onload = () => {
            accessToken = getTokenFromUrl();
            if (accessToken) {
                initializePlayer();
            }
        };

        const initializePlayer = () => {
            const player = new Spotify.Player({
                name: 'Web Player',
                getOAuthToken: cb => { cb(accessToken); },
                volume: 0.5
            });

            // Connect to the player!
            player.connect();

            // Fetch and display songs, then play selected song
            fetchSongs();
        };

        const fetchSongs = async () => {
            // Example search, replace with your implementation
            const response = await fetch(`https://api.spotify.com/v1/search?q=track_name&type=track`, {
                headers: { 'Authorization': `Bearer ${accessToken}` }
            });
            const data = await response.json();
            displaySongs(data.tracks.items);
        };

        const displaySongs = (songs) => {
            const songList = document.getElementById('songList');
            songList.innerHTML = '';
            songs.forEach(song => {
                const li = document.createElement('li');
                li.textContent = `${song.name} by ${song.artists.map(artist => artist.name).join(', ')}`;
                li.addEventListener('click', () => {
                    playSong(song.uri);
                });
                songList.appendChild(li);
            });
        };

        const playSong = (uri) => {
            const player = new Spotify.Player({
                name: 'Web Player',
                getOAuthToken: cb => { cb(accessToken); },
            });
            player.connect().then(success => {
                if (success) {
                    player.resume().then(() => {
                        player.play({ uris: [uri] });
                    });
                }
            });
        };
    </script>
</body>
</html>
